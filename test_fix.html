<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .output {
            margin-top: 10px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>ç™»å½•ä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•1: localStorageæ“ä½œ</h2>
        <button onclick="testLocalStorage()">æµ‹è¯•localStorage</button>
        <div id="localStorageOutput" class="output"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯•2: æ¨¡æ‹Ÿç™»å½•æµç¨‹</h2>
        <button onclick="simulateLogin()">æ¨¡æ‹Ÿç™»å½•</button>
        <div id="loginOutput" class="output"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯•3: æ£€æŸ¥ç”¨æˆ·è®¤è¯çŠ¶æ€</h2>
        <button onclick="testAuthentication()">æ£€æŸ¥è®¤è¯çŠ¶æ€</button>
        <div id="authOutput" class="output"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯•4: æ¸…ç†æµ‹è¯•æ•°æ®</h2>
        <button onclick="clearTestData()">æ¸…ç†æ•°æ®</button>
        <div id="clearOutput" class="output"></div>
    </div>

    <script>
        // è¾“å‡ºå‡½æ•°
        function output(id, message) {
            const div = document.getElementById(id);
            div.innerHTML += message + '<br>';
        }
        
        // æ¸…é™¤è¾“å‡º
        function clearOutput(id) {
            document.getElementById(id).innerHTML = '';
        }
        
        // æµ‹è¯•1: localStorageæ“ä½œ
        function testLocalStorage() {
            clearOutput('localStorageOutput');
            output('localStorageOutput', 'å¼€å§‹æµ‹è¯•localStorage...');
            
            // æµ‹è¯•setItem
            localStorage.setItem('testKey', 'testValue');
            output('localStorageOutput', 'ä¿å­˜æµ‹è¯•æ•°æ®: testKey = testValue');
            
            // æµ‹è¯•getItem
            const value = localStorage.getItem('testKey');
            output('localStorageOutput', 'è·å–æµ‹è¯•æ•°æ®: ' + value);
            
            // éªŒè¯ç»“æœ
            if (value === 'testValue') {
                output('localStorageOutput', 'âœ… localStorageæµ‹è¯•æˆåŠŸ');
            } else {
                output('localStorageOutput', 'âŒ localStorageæµ‹è¯•å¤±è´¥');
            }
            
            // æ¸…ç†æµ‹è¯•æ•°æ®
            localStorage.removeItem('testKey');
        }
        
        // æµ‹è¯•2: æ¨¡æ‹Ÿç™»å½•æµç¨‹
        function simulateLogin() {
            clearOutput('loginOutput');
            output('loginOutput', 'å¼€å§‹æ¨¡æ‹Ÿç™»å½•...');
            
            // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®
            const user = {
                id: Date.now(),
                username: 'testuser',
                email: 'test@example.com',
                name: 'æµ‹è¯•ç”¨æˆ·',
                avatar: 'ğŸ‘¤',
                joinDate: new Date().toISOString().split('T')[0],
                level: 1
            };
            
            output('loginOutput', 'åˆ›å»ºç”¨æˆ·: ' + JSON.stringify(user, null, 2));
            
            // ä¿å­˜ç”¨æˆ·æ•°æ®åˆ°localStorage
            const userData = {
                id: user.id,
                username: user.username,
                email: user.email,
                name: user.name,
                avatar: user.avatar,
                joinDate: user.joinDate,
                level: user.level,
                loginTime: new Date().toISOString()
            };
            
            localStorage.setItem('yueyangCurrentUser', JSON.stringify(userData));
            localStorage.setItem('justLoggedIn', 'true');
            
            output('loginOutput', 'ä¿å­˜ç”¨æˆ·æ•°æ®åˆ°localStorage');
            
            // éªŒè¯ä¿å­˜ç»“æœ
            const savedUser = localStorage.getItem('yueyangCurrentUser');
            const justLoggedIn = localStorage.getItem('justLoggedIn');
            
            if (savedUser && justLoggedIn === 'true') {
                output('loginOutput', 'âœ… ç™»å½•æ¨¡æ‹ŸæˆåŠŸ');
                output('loginOutput', 'ä¿å­˜çš„ç”¨æˆ·æ•°æ®: ' + JSON.stringify(JSON.parse(savedUser), null, 2));
            } else {
                output('loginOutput', 'âŒ ç™»å½•æ¨¡æ‹Ÿå¤±è´¥');
            }
        }
        
        // æµ‹è¯•3: æ£€æŸ¥ç”¨æˆ·è®¤è¯çŠ¶æ€
        function testAuthentication() {
            clearOutput('authOutput');
            output('authOutput', 'å¼€å§‹æ£€æŸ¥è®¤è¯çŠ¶æ€...');
            
            // æ¨¡æ‹ŸcheckUserAuthenticationå‡½æ•°
            const savedUser = localStorage.getItem('yueyangCurrentUser');
            if (savedUser) {
                const user = JSON.parse(savedUser);
                output('authOutput', 'âœ… å·²æ‰¾åˆ°ç™»å½•ç”¨æˆ·: ' + user.username);
                output('authOutput', 'ç”¨æˆ·ä¿¡æ¯: ' + JSON.stringify(user, null, 2));
            } else {
                output('authOutput', 'âŒ æœªæ‰¾åˆ°ç™»å½•ç”¨æˆ·');
            }
            
            // æ¨¡æ‹Ÿå½“å‰é¡µé¢æ£€æŸ¥
            const currentPage = window.location.href.split('/').pop();
            output('authOutput', 'å½“å‰é¡µé¢: ' + currentPage);
            
            if (currentPage !== 'login.html' && currentPage !== 'register.html') {
                if (!savedUser) {
                    output('authOutput', 'âš ï¸ ä¸åœ¨ç™»å½•/æ³¨å†Œé¡µé¢ä¸”æœªç™»å½•ï¼Œåº”è·³è½¬åˆ°ç™»å½•é¡µé¢');
                } else {
                    output('authOutput', 'âœ… åœ¨éç™»å½•/æ³¨å†Œé¡µé¢ä¸”å·²ç™»å½•ï¼Œæ­£å¸¸è®¿é—®');
                }
            }
        }
        
        // æµ‹è¯•4: æ¸…ç†æµ‹è¯•æ•°æ®
        function clearTestData() {
            clearOutput('clearOutput');
            output('clearOutput', 'å¼€å§‹æ¸…ç†æµ‹è¯•æ•°æ®...');
            
            localStorage.removeItem('yueyangCurrentUser');
            localStorage.removeItem('justLoggedIn');
            localStorage.removeItem('testKey');
            
            output('clearOutput', 'âœ… æµ‹è¯•æ•°æ®å·²æ¸…ç†');
            output('clearOutput', 'å½“å‰localStorageå†…å®¹:');
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                output('clearOutput', '  ' + key + ': ' + value);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œçš„åˆå§‹åŒ–ä»£ç 
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMåŠ è½½å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•');
        });
    </script>
</body>
</html>