<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒ…ç»ªé™ªä¼´ - æ‚¦å…»</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Serif+SC:wght@400;700&family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: #f8fafc;
            padding-bottom: 80px;
        }
        .app-header {
            background: linear-gradient(135deg, #F59E0B, #FBBF24);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            padding: 0.5rem 0;
            z-index: 1000;
        }
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 0.5rem;
            color: #6b7280;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        .nav-item.active {
            color: #F59E0B;
        }
        .nav-item:hover {
            color: #F59E0B;
        }
        .mood-card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .mood-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        .mood-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin: 1rem 0;
        }
        .mood-item {
            text-align: center;
            padding: 1.5rem;
            border: 2px solid #e5e7eb;
            border-radius: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        .mood-item:hover {
            border-color: #F59E0B;
            background: #fffbeb;
        }
        .mood-item.selected {
            border-color: #F59E0B;
            background: #fef3c7;
        }
        .chat-container {
            height: 400px;
            overflow-y: auto;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
        }
        .chat-bubble {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            margin: 0.5rem 0;
            position: relative;
            word-wrap: break-word;
        }
        .chat-bubble.user {
            background: #F59E0B;
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 0.25rem;
        }
        .chat-bubble.ai {
            background: white;
            color: #374151;
            margin-right: auto;
            border-bottom-left-radius: 0.25rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .mood-history-item {
            background: white;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-left: 4px solid #F59E0B;
        }
        .mood-chart {
            height: 300px;
            background: white;
            border-radius: 1rem;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        .floating-btn {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: #F59E0B;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 999;
        }
        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.6);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        .modal.show {
            display: flex;
        }
        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <!-- åº”ç”¨å¤´éƒ¨ -->
    <header class="app-header">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <h1 class="text-xl font-bold" style="font-family: 'ZCOOL KuaiLe', cursive;">æ‚¦å…»</h1>
                <span class="text-sm opacity-90">æƒ…ç»ªé™ªä¼´ä¸­å¿ƒ</span>
            </div>
            <div class="flex items-center space-x-3">
                <span class="text-sm" id="userGreeting">ä½ å¥½ï¼</span>
                <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
                    <span>ğŸ‘¤</span>
                </div>
            </div>
        </div>
    </header>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <main class="px-4 py-6 space-y-6">
        <!-- ä»Šæ—¥æƒ…ç»ªè®°å½• -->
        <div class="mood-card">
            <h2 class="text-lg font-bold text-gray-900 mb-4">ä»Šæ—¥æƒ…ç»ªè®°å½•</h2>
            <div class="mood-selector">
                <div class="mood-item" onclick="selectTodayMood('happy')">
                    <div class="text-3xl mb-2">ğŸ˜Š</div>
                    <div class="text-sm font-medium">å¼€å¿ƒ</div>
                </div>
                <div class="mood-item" onclick="selectTodayMood('tired')">
                    <div class="text-3xl mb-2">ğŸ˜´</div>
                    <div class="text-sm font-medium">ç–²æƒ«</div>
                </div>
                <div class="mood-item" onclick="selectTodayMood('stressed')">
                    <div class="text-3xl mb-2">ğŸ˜°</div>
                    <div class="text-sm font-medium">å‹åŠ›</div>
                </div>
                <div class="mood-item" onclick="selectTodayMood('anxious')">
                    <div class="text-3xl mb-2">ğŸ˜Ÿ</div>
                    <div class="text-sm font-medium">ç„¦è™‘</div>
                </div>
            </div>
            <div class="mt-4">
                <textarea id="moodNote" placeholder="å†™ä¸‹ä½ çš„æƒ³æ³•æˆ–æ„Ÿå—..." class="w-full p-3 border rounded-lg focus:outline-none focus:border-orange-500" rows="3"></textarea>
            </div>
            <div class="flex gap-3 mt-4">
                <button onclick="saveTodayMood()" class="flex-1 bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600 transition-colors">
                    ä¿å­˜æƒ…ç»ªè®°å½•
                </button>
            </div>
        </div>

        <!-- AIæƒ…ç»ªæ ‘æ´ -->
        <div class="mood-card">
            <h3 class="text-lg font-bold text-gray-900 mb-4">AIæƒ…ç»ªæ ‘æ´</h3>
            <div class="chat-container" id="moodChatContainer">
                <div class="chat-bubble ai">
                    å—¨ï¼æˆ‘æ˜¯ä½ çš„ä¸“å±æƒ…ç»ªé™ªä¼´å¸ˆï¼Œæœ‰ä»€ä¹ˆå¿ƒäº‹éƒ½å¯ä»¥è·Ÿæˆ‘è¯´å“¦ï½æˆ‘ä¼šç”¨å¿ƒå€¾å¬ï¼Œç»™ä½ æ¸©æš–çš„å›åº”ã€‚
                </div>
            </div>
            <div class="flex gap-2">
                <input type="text" id="moodChatInput" placeholder="åˆ†äº«ä½ çš„æƒ³æ³•..." class="flex-1 p-3 border rounded-lg focus:outline-none focus:border-orange-500">
                <button onclick="sendMoodMessage()" class="bg-orange-500 text-white px-4 py-3 rounded-lg hover:bg-orange-600 transition-colors">
                    å‘é€
                </button>
            </div>
        </div>

        <!-- æƒ…ç»ªå……ç”µç«™ -->
        <div class="mood-card">
            <h3 class="text-lg font-bold text-gray-900 mb-4">æƒ…ç»ªå……ç”µç«™</h3>
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-gradient-to-br from-blue-50 to-cyan-50 p-4 rounded-lg text-center cursor-pointer hover:shadow-md transition-shadow" onclick="openRelaxContent('music')">
                    <div class="text-3xl mb-2">ğŸµ</div>
                    <h4 class="font-semibold text-gray-900 mb-1">èˆ’ç¼“éŸ³ä¹</h4>
                    <p class="text-sm text-gray-600">æ”¾æ¾èº«å¿ƒçš„éŸ³ä¹</p>
                </div>
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-4 rounded-lg text-center cursor-pointer hover:shadow-md transition-shadow" onclick="openRelaxContent('meditation')">
                    <div class="text-3xl mb-2">ğŸ§˜</div>
                    <h4 class="font-semibold text-gray-900 mb-1">å†¥æƒ³æŒ‡å¯¼</h4>
                    <p class="text-sm text-gray-600">ä¸“ä¸šå†¥æƒ³ç»ƒä¹ </p>
                </div>
                <div class="bg-gradient-to-br from-purple-50 to-violet-50 p-4 rounded-lg text-center cursor-pointer hover:shadow-md transition-shadow" onclick="openRelaxContent('breathing')">
                    <div class="text-3xl mb-2">ğŸ’¨</div>
                    <h4 class="font-semibold text-gray-900 mb-1">å‘¼å¸ç»ƒä¹ </h4>
                    <p class="text-sm text-gray-600">è°ƒèŠ‚å‘¼å¸èŠ‚å¥</p>
                </div>
                <div class="bg-gradient-to-br from-pink-50 to-rose-50 p-4 rounded-lg text-center cursor-pointer hover:shadow-md transition-shadow" onclick="openRelaxContent('article')">
                    <div class="text-3xl mb-2">ğŸ“–</div>
                    <h4 class="font-semibold text-gray-900 mb-1">æ²»æ„ˆæ–‡ç« </h4>
                    <p class="text-sm text-gray-600">æ¸©æš–æ²»æ„ˆæ–‡å­—</p>
                </div>
            </div>
        </div>

        <!-- æƒ…ç»ªå†å² -->
        <div class="mood-card">
            <h3 class="text-lg font-bold text-gray-900 mb-4">æƒ…ç»ªå†å²è®°å½•</h3>
            <div id="moodHistory">
                <!-- åŠ¨æ€ç”Ÿæˆæƒ…ç»ªå†å² -->
            </div>
            <div class="text-center mt-4">
                <button onclick="loadMoreMoodHistory()" class="text-orange-600 text-sm font-medium hover:text-orange-700">
                    æŸ¥çœ‹æ›´å¤šå†å²è®°å½•
                </button>
            </div>
        </div>

        <!-- æƒ…ç»ªè¶‹åŠ¿å›¾è¡¨ -->
        <div class="mood-card">
            <h3 class="text-lg font-bold text-gray-900 mb-4">æƒ…ç»ªå˜åŒ–è¶‹åŠ¿</h3>
            <div class="mood-chart" id="moodChart"></div>
        </div>
    </main>

    <!-- æµ®åŠ¨æŒ‰é’® -->
    <div class="floating-btn" onclick="showQuickMoodActions()">
        <span>ğŸ’</span>
    </div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <nav class="bottom-nav">
        <div class="flex">
            <a href="index.html" class="nav-item">
                <div class="text-xl mb-1">ğŸ </div>
                <div class="text-xs">é¦–é¡µ</div>
            </a>
            <a href="tasks.html" class="nav-item">
                <div class="text-xl mb-1">ğŸ¯</div>
                <div class="text-xs">ä»»åŠ¡</div>
            </a>
            <a href="mood.html" class="nav-item active">
                <div class="text-xl mb-1">ğŸ’</div>
                <div class="text-xs">æƒ…ç»ª</div>
            </a>
            <a href="profile.html" class="nav-item">
                <div class="text-xl mb-1">ğŸ‘¤</div>
                <div class="text-xs">æˆ‘çš„</div>
            </a>
        </div>
    </nav>

    <!-- æ”¾æ¾å†…å®¹æ¨¡æ€æ¡† -->
    <div id="relaxModal" class="modal">
        <div class="modal-content max-w-md w-full mx-4">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold text-gray-900" id="relaxTitle">æ”¾æ¾å†…å®¹</h3>
                <button onclick="closeModal('relaxModal')" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <div id="relaxContent">
                <!-- åŠ¨æ€ç”Ÿæˆæ”¾æ¾å†…å®¹ -->
            </div>
        </div>
    </div>

    <script>
        // æƒ…ç»ªæ•°æ®
        let currentMood = null;
        let moodChart = null;

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            loadAppData();
            initializeMoodPage();
            renderMoodHistory();
            initializeMoodChart();
        });

        // åŠ è½½åº”ç”¨æ•°æ®
        function loadAppData() {
            const savedData = localStorage.getItem('yueyangAppData');
            if (savedData) {
                window.appData = { ...window.appData, ...JSON.parse(savedData) };
            }
        }

        // ä¿å­˜åº”ç”¨æ•°æ®
        function saveAppData() {
            localStorage.setItem('yueyangAppData', JSON.stringify(window.appData));
        }

        // åˆå§‹åŒ–æƒ…ç»ªé¡µé¢
        function initializeMoodPage() {
            // è®¾ç½®ç”¨æˆ·é—®å€™
            const userGreeting = document.getElementById('userGreeting');
            if (userGreeting) {
                userGreeting.textContent = `ä½ å¥½ï¼Œ${window.appData.user.name}ï¼`;
            }

            // å¦‚æœæœ‰ä»Šæ—¥æƒ…ç»ªï¼Œæ˜¾ç¤ºé€‰ä¸­çŠ¶æ€
            if (window.appData.mood.today) {
                selectTodayMood(window.appData.mood.today);
            }

            // åˆå§‹åŒ–AIèŠå¤©
            initializeMoodChat();
        }

        // é€‰æ‹©ä»Šæ—¥æƒ…ç»ª
        function selectTodayMood(mood) {
            currentMood = mood;
            
            // æ›´æ–°é€‰æ‹©çŠ¶æ€
            document.querySelectorAll('.mood-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.target.closest('.mood-item').classList.add('selected');
            
            window.appData.mood.today = mood;
            
            const moodEmojis = {
                happy: 'ğŸ˜Š',
                tired: 'ğŸ˜´',
                stressed: 'ğŸ˜°',
                anxious: 'ğŸ˜Ÿ'
            };
            
            window.appData.mood.currentEmoji = moodEmojis[mood];
            saveAppData();
        }

        // ä¿å­˜ä»Šæ—¥æƒ…ç»ª
        function saveTodayMood() {
            const note = document.getElementById('moodNote').value.trim();
            
            if (!currentMood) {
                showToast('è¯·å…ˆé€‰æ‹©ä½ çš„æƒ…ç»ªçŠ¶æ€', 'error');
                return;
            }
            
            const moodRecord = {
                mood: currentMood,
                note: note,
                timestamp: new Date().toISOString()
            };
            
            window.appData.mood.history.unshift(moodRecord);
            window.appData.stats.totalMoodRecords++;
            
            showToast('æƒ…ç»ªè®°å½•ä¿å­˜æˆåŠŸï¼', 'success');
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('moodNote').value = '';
            
            // é‡æ–°æ¸²æŸ“æƒ…ç»ªå†å²
            renderMoodHistory();
            
            // æ›´æ–°æƒ…ç»ªå›¾è¡¨
            updateMoodChart();
            
            saveAppData();
            
            // AIå›å¤
            setTimeout(() => {
                const aiResponse = generateMoodResponse(currentMood, note);
                addMoodChatMessage(aiResponse, 'ai');
            }, 1000);
        }

        // åˆå§‹åŒ–æƒ…ç»ªèŠå¤©
        function initializeMoodChat() {
            const chatContainer = document.getElementById('moodChatContainer');
            if (chatContainer && chatContainer.children.length <= 1) {
                const welcomeMessages = [
                    'æˆ‘æ˜¯ä½ çš„ä¸“å±æƒ…ç»ªé™ªä¼´å¸ˆï¼Œæœ‰ä»€ä¹ˆå¿ƒäº‹éƒ½å¯ä»¥è·Ÿæˆ‘è¯´å“¦ï½',
                    'æ¯ä¸ªäººéƒ½ä¼šæœ‰æƒ…ç»ªæ³¢åŠ¨ï¼Œè¿™æ˜¯å¾ˆæ­£å¸¸çš„äº‹æƒ…ã€‚',
                    'æœ‰æ—¶å€™æŠŠå¿ƒé‡Œçš„è¯è¯´å‡ºæ¥ï¼Œä¼šæ„Ÿè§‰è½»æ¾å¾ˆå¤šã€‚',
                    'æˆ‘åœ¨è¿™é‡Œé™ªç€ä½ ï¼Œä¸€èµ·é¢å¯¹ç”Ÿæ´»ä¸­çš„å–œæ€’å“€ä¹ã€‚'
                ];
                
                const randomMessage = welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];
                addMoodChatMessage(randomMessage, 'ai');
            }
        }

        // å‘é€æƒ…ç»ªæ¶ˆæ¯
        function sendMoodMessage() {
            const input = document.getElementById('moodChatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMoodChatMessage(message, 'user');
            input.value = '';
            
            // AIå›å¤
            setTimeout(() => {
                const aiResponse = generateMoodChatResponse(message);
                addMoodChatMessage(aiResponse, 'ai');
            }, 1000 + Math.random() * 1000);
        }

        // æ·»åŠ æƒ…ç»ªèŠå¤©æ¶ˆæ¯
        function addMoodChatMessage(message, type) {
            const chatContainer = document.getElementById('moodChatContainer');
            if (!chatContainer) return;
            
            const messageElement = document.createElement('div');
            messageElement.className = `chat-bubble ${type}`;
            messageElement.textContent = message;
            
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // åŠ¨ç”»æ•ˆæœ
            anime({
                targets: messageElement,
                opacity: [0, 1],
                translateY: [20, 0],
                duration: 500,
                easing: 'easeOutQuad'
            });
        }

        // ç”Ÿæˆæƒ…ç»ªå“åº”
        function generateMoodResponse(mood, note) {
            const responses = {
                happy: [
                    'å¤ªæ£’äº†ï¼ä¿æŒè¿™ç§å¥½å¿ƒæƒ…ï¼Œä»Šå¤©ä¸€å®šä¼šå¾ˆé¡ºåˆ©çš„ï¼',
                    'å¼€å¿ƒçš„å¿ƒæƒ…æ˜¯æœ€å¥½çš„å…»ç”Ÿè‰¯è¯ï¼Œè®°å¾—å¤šåˆ†äº«å¿«ä¹å“¦ï½',
                    'çœ‹åˆ°ä½ è¿™ä¹ˆå¼€å¿ƒï¼Œæˆ‘ä¹Ÿå¾ˆå¼€å¿ƒå‘¢ï¼ç»§ç»­ä¿æŒè¿™ç§ç§¯æçš„çŠ¶æ€å§ï¼'
                ],
                tired: [
                    'ç–²æƒ«çš„æ—¶å€™è¦æ³¨æ„ä¼‘æ¯å“¦ï¼Œèº«ä½“æ˜¯æœ€é‡è¦çš„ï¼',
                    'å·¥ä½œå†å¿™ä¹Ÿè¦ç…§é¡¾å¥½è‡ªå·±ï¼Œå»ºè®®å°æ†©15åˆ†é’Ÿæ¢å¤ç²¾åŠ›ã€‚',
                    'ç–²åŠ³æ˜¯èº«ä½“åœ¨æé†’ä½ éœ€è¦ä¼‘æ¯ï¼Œå¬å¬èˆ’ç¼“çš„éŸ³ä¹æ€ä¹ˆæ ·ï¼Ÿ'
                ],
                stressed: [
                    'å‹åŠ›å¤§çš„æ—¶å€™æ›´è¦å­¦ä¼šæ”¾æ¾ï¼Œè¯•è¯•5åˆ†é’Ÿçš„å†¥æƒ³å§ï½',
                    'æˆ‘ç†è§£ä½ çš„å‹åŠ›ï¼Œè®°å¾—è¦ç»™è‡ªå·±ä¸€äº›å–˜æ¯çš„ç©ºé—´å“¦ã€‚',
                    'å‹åŠ›æ˜¯æš‚æ—¶çš„ï¼Œç›¸ä¿¡ä½ ä¸€å®šèƒ½å¤Ÿå¾ˆå¥½åœ°å¤„ç†ï¼'
                ],
                anxious: [
                    'ç„¦è™‘çš„æ—¶å€™è¯•è¯•å†™ä¸‹æ¥ï¼ŒæŠŠæ‹…å¿§éƒ½å†™åœ¨çº¸ä¸Šä¼šå¥½å¾ˆå¤šã€‚',
                    'æ·±å‘¼å¸ï¼Œä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„ã€‚ä½ å¾ˆæ£’ï¼Œè¦ç›¸ä¿¡è‡ªå·±ï¼',
                    'ç„¦è™‘æ˜¯æš‚æ—¶çš„ï¼Œåšä¸€äº›å–œæ¬¢çš„äº‹æƒ…è½¬ç§»æ³¨æ„åŠ›å§ï½'
                ]
            };
            
            const moodResponses = responses[mood] || responses.happy;
            return moodResponses[Math.floor(Math.random() * moodResponses.length)];
        }

        // ç”Ÿæˆæƒ…ç»ªèŠå¤©å“åº”
        function generateMoodChatResponse(message) {
            const keywords = {
                'ç´¯': ['ç´¯äº†å°±è¦å¥½å¥½ä¼‘æ¯å“¦ï¼Œèº«ä½“æ˜¯æœ€é‡è¦çš„ï¼', 'ç–²æƒ«çš„æ—¶å€™è¯•è¯•æ·±å‘¼å¸ï¼Œæˆ–è€…å¬äº›è½»éŸ³ä¹ï½'],
                'çƒ¦': ['æˆ‘ç†è§£ä½ çš„çƒ¦æ¼ï¼Œè¯´å‡ºæ¥ä¼šå¥½å—ä¸€äº›ã€‚', 'æ¯ä¸ªäººéƒ½ä¼šæœ‰çƒ¦æ¼çš„æ—¶å€™ï¼Œé‡è¦çš„æ˜¯è¦å­¦ä¼šè°ƒèŠ‚ã€‚'],
                'å‹åŠ›': ['å‹åŠ›å¤§çš„æ—¶å€™æ›´è¦å­¦ä¼šæ”¾æ¾ï¼Œè¯•è¯•å†¥æƒ³å§ï½', 'æˆ‘ç†è§£ä½ çš„å‹åŠ›ï¼Œè®°å¾—è¦ç»™è‡ªå·±ä¸€äº›å–˜æ¯çš„ç©ºé—´å“¦ã€‚'],
                'å¼€å¿ƒ': ['çœ‹åˆ°ä½ å¼€å¿ƒæˆ‘ä¹Ÿå¾ˆå¼€å¿ƒå‘¢ï¼', 'ä¿æŒå¥½å¿ƒæƒ…ï¼Œä»Šå¤©ä¸€å®šä¼šå¾ˆé¡ºåˆ©çš„ï¼'],
                'è°¢è°¢': ['ä¸å®¢æ°”ï¼Œè¿™æ˜¯æˆ‘åº”è¯¥åšçš„ï¼', 'èƒ½å¸®åˆ°ä½ æˆ‘ä¹Ÿå¾ˆå¼€å¿ƒï½'],
                'ä½ å¥½': ['ä½ å¥½å‘€ï¼ä»Šå¤©æ„Ÿè§‰æ€ä¹ˆæ ·ï¼Ÿ', 'å—¨ï¼å¾ˆé«˜å…´å’Œä½ èŠå¤©ï½']
            };
            
            for (const [keyword, responses] of Object.entries(keywords)) {
                if (message.includes(keyword)) {
                    return responses[Math.floor(Math.random() * responses.length)];
                }
            }
            
            const defaultResponses = [
                'æˆ‘æ˜ç™½äº†ï¼Œç»§ç»­è¯´ä¸‹å»å§ï½',
                'å¬èµ·æ¥å¾ˆæœ‰æ„æ€ï¼Œèƒ½è¯¦ç»†è¯´è¯´å—ï¼Ÿ',
                'æˆ‘ç†è§£ä½ çš„æ„Ÿå—ï¼Œæƒ³èŠèŠæ›´å¤šå—ï¼Ÿ',
                'æ¯ä¸ªäººéƒ½æœ‰è¿™æ ·çš„æ—¶åˆ»ï¼Œæˆ‘ä»¬ä¸€èµ·é¢å¯¹ï½',
                'ä½ è¯´å¾—å¯¹ï¼Œè¿™ç¡®å®å¾ˆé‡è¦ã€‚'
            ];
            
            return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
        }

        // æ¸²æŸ“æƒ…ç»ªå†å²
        function renderMoodHistory() {
            const historyElement = document.getElementById('moodHistory');
            if (!historyElement) return;
            
            historyElement.innerHTML = '';
            
            const recentHistory = window.appData.mood.history.slice(0, 5);
            
            if (recentHistory.length === 0) {
                historyElement.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <div class="text-4xl mb-2">ğŸ’</div>
                        <p>è¿˜æ²¡æœ‰æƒ…ç»ªè®°å½•</p>
                        <p class="text-sm">å¼€å§‹è®°å½•ä½ çš„æƒ…ç»ªå˜åŒ–å§ï½</p>
                    </div>
                `;
                return;
            }
            
            recentHistory.forEach(record => {
                const date = new Date(record.timestamp).toLocaleDateString('zh-CN');
                const time = new Date(record.timestamp).toLocaleTimeString('zh-CN', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const moodEmojis = {
                    happy: 'ğŸ˜Š',
                    tired: 'ğŸ˜´',
                    stressed: 'ğŸ˜°',
                    anxious: 'ğŸ˜Ÿ'
                };
                
                const moodNames = {
                    happy: 'å¼€å¿ƒ',
                    tired: 'ç–²æƒ«',
                    stressed: 'å‹åŠ›',
                    anxious: 'ç„¦è™‘'
                };
                
                const historyItem = document.createElement('div');
                historyItem.className = 'mood-history-item';
                historyItem.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="text-2xl">${moodEmojis[record.mood]}</div>
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="font-semibold text-gray-900">${moodNames[record.mood]}</span>
                                <span class="text-xs text-gray-500">${date} ${time}</span>
                            </div>
                            ${record.note ? `<p class="text-sm text-gray-600">${record.note}</p>` : ''}
                        </div>
                    </div>
                `;
                historyElement.appendChild(historyItem);
            });
        }

        // åŠ è½½æ›´å¤šæƒ…ç»ªå†å²
        function loadMoreMoodHistory() {
            showToast('å†å²è®°å½•åŠŸèƒ½å¼€å‘ä¸­...', 'info');
        }

        // åˆå§‹åŒ–æƒ…ç»ªå›¾è¡¨
        function initializeMoodChart() {
            const chartElement = document.getElementById('moodChart');
            if (!chartElement) return;
            
            moodChart = echarts.init(chartElement);
            updateMoodChart();
        }

        // æ›´æ–°æƒ…ç»ªå›¾è¡¨
        function updateMoodChart() {
            if (!moodChart) return;
            
            const last7Days = [];
            const moodData = [];
            
            // ç”Ÿæˆæœ€è¿‘7å¤©çš„æ•°æ®
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                last7Days.push(date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' }));
                
                // æŸ¥æ‰¾å½“å¤©çš„æƒ…ç»ªè®°å½•
                const dayRecord = window.appData.mood.history.find(record => 
                    record.timestamp.split('T')[0] === dateStr
                );
                
                if (dayRecord) {
                    const moodScores = {
                        happy: 4,
                        tired: 2,
                        stressed: 1,
                        anxious: 1
                    };
                    moodData.push(moodScores[dayRecord.mood] || 3);
                } else {
                    moodData.push(3); // é»˜è®¤ä¸­æ€§æƒ…ç»ª
                }
            }
            
            const option = {
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        const value = params[0].value;
                        let moodText = 'ä¸­æ€§';
                        if (value >= 4) moodText = 'å¼€å¿ƒ';
                        else if (value <= 1) moodText = 'ä½è½';
                        else if (value <= 2) moodText = 'ç–²æƒ«';
                        
                        return `${params[0].name}<br/>æƒ…ç»ªçŠ¶æ€: ${moodText}`;
                    }
                },
                xAxis: {
                    type: 'category',
                    data: last7Days,
                    axisLine: { show: false },
                    axisTick: { show: false }
                },
                yAxis: {
                    type: 'value',
                    min: 0,
                    max: 5,
                    show: false
                },
                series: [{
                    name: 'æƒ…ç»ªæŒ‡æ•°',
                    type: 'line',
                    data: moodData,
                    smooth: true,
                    lineStyle: {
                        color: '#F59E0B',
                        width: 3
                    },
                    itemStyle: {
                        color: '#F59E0B'
                    },
                    areaStyle: {
                        color: {
                            type: 'linear',
                            x: 0,
                            y: 0,
                            x2: 0,
                            y2: 1,
                            colorStops: [{
                                offset: 0, color: 'rgba(245, 158, 11, 0.3)'
                            }, {
                                offset: 1, color: 'rgba(245, 158, 11, 0.05)'
                            }]
                        }
                    }
                }],
                grid: {
                    left: 10,
                    right: 10,
                    top: 20,
                    bottom: 30
                }
            };
            
            moodChart.setOption(option);
        }

        // æ‰“å¼€æ”¾æ¾å†…å®¹
        function openRelaxContent(type) {
            const title = {
                'music': 'èˆ’ç¼“éŸ³ä¹',
                'meditation': 'å†¥æƒ³æŒ‡å¯¼',
                'breathing': 'å‘¼å¸ç»ƒä¹ ',
                'article': 'æ²»æ„ˆæ–‡ç« '
            };
            
            document.getElementById('relaxTitle').textContent = title[type];
            
            const content = generateRelaxContent(type);
            document.getElementById('relaxContent').innerHTML = content;
            
            showModal('relaxModal');
        }

        // ç”Ÿæˆæ”¾æ¾å†…å®¹
        function generateRelaxContent(type) {
            const contents = {
                music: `
                    <div class="text-center">
                        <div class="text-6xl mb-4">ğŸµ</div>
                        <h4 class="text-lg font-semibold mb-4">èˆ’ç¼“éŸ³ä¹æ’­æ”¾</h4>
                        <div class="bg-gradient-to-r from-blue-100 to-purple-100 p-6 rounded-lg mb-4">
                            <p class="text-gray-700 mb-4">æ­£åœ¨æ’­æ”¾ï¼šæ£®æ—ä¸­çš„é¸Ÿé¸£å£°</p>
                            <div class="flex items-center justify-center space-x-4">
                                <button class="bg-orange-500 text-white px-4 py-2 rounded-lg">â®ï¸</button>
                                <button class="bg-orange-500 text-white px-6 py-3 rounded-lg text-xl">â–¶ï¸</button>
                                <button class="bg-orange-500 text-white px-4 py-2 rounded-lg">â­ï¸</button>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600">è®©è‡ªç„¶çš„éŸ³ä¹å¸¦èµ°ä½ çš„çƒ¦æ¼ï¼Œæ”¾æ¾èº«å¿ƒã€‚</p>
                    </div>
                `,
                meditation: `
                    <div class="text-center">
                        <div class="text-6xl mb-4">ğŸ§˜</div>
                        <h4 class="text-lg font-semibold mb-4">5åˆ†é’Ÿå†¥æƒ³æŒ‡å¯¼</h4>
                        <div class="bg-gradient-to-r from-green-100 to-emerald-100 p-6 rounded-lg mb-4">
                            <p class="text-gray-700 mb-4">æ‰¾ä¸€ä¸ªèˆ’é€‚çš„å§¿åŠ¿ï¼Œé—­ä¸Šçœ¼ç›</p>
                            <div class="text-2xl font-bold text-green-600 mb-4" id="meditationTimer">5:00</div>
                            <button onclick="startMeditation()" class="bg-orange-500 text-white px-6 py-3 rounded-lg">
                                å¼€å§‹å†¥æƒ³
                            </button>
                        </div>
                        <p class="text-sm text-gray-600">ä¸“æ³¨äºå‘¼å¸ï¼Œè®©æ€ç»ªæ…¢æ…¢å¹³é™ä¸‹æ¥ã€‚</p>
                    </div>
                `,
                breathing: `
                    <div class="text-center">
                        <div class="text-6xl mb-4">ğŸ’¨</div>
                        <h4 class="text-lg font-semibold mb-4">4-7-8å‘¼å¸æ³•</h4>
                        <div class="bg-gradient-to-r from-purple-100 to-pink-100 p-6 rounded-lg mb-4">
                            <div class="text-6xl mb-4" id="breathingGuide">ğŸ«</div>
                            <p class="text-gray-700 mb-4" id="breathingInstruction">ç”¨é¼»å­å¸æ°”4ç§’</p>
                            <button onclick="startBreathing()" class="bg-orange-500 text-white px-6 py-3 rounded-lg">
                                å¼€å§‹ç»ƒä¹ 
                            </button>
                        </div>
                        <p class="text-sm text-gray-600">è¿™ç§å‘¼å¸æ³•æœ‰åŠ©äºç¼“è§£ç„¦è™‘å’Œå‹åŠ›ã€‚</p>
                    </div>
                `,
                article: `
                    <div>
                        <div class="text-6xl mb-4 text-center">ğŸ“–</div>
                        <h4 class="text-lg font-semibold mb-4 text-center">æ²»æ„ˆå°æ–‡ç« </h4>
                        <div class="bg-gradient-to-r from-yellow-100 to-orange-100 p-6 rounded-lg mb-4">
                            <h5 class="font-semibold mb-3">ã€Šæ…¢æ…¢æ¥ï¼Œä¸€åˆ‡éƒ½ä¼šå¥½çš„ã€‹</h5>
                            <p class="text-gray-700 text-sm leading-relaxed mb-3">
                                ç”Ÿæ´»å°±åƒä¸€æ¯èŒ¶ï¼Œä¸ä¼šè‹¦ä¸€è¾ˆå­ï¼Œä½†æ€»ä¼šè‹¦ä¸€é˜µå­ã€‚å½“ä½ è§‰å¾—åšæŒä¸ä¸‹å»çš„æ—¶å€™ï¼Œ
                                è¯•ç€å‘Šè¯‰è‡ªå·±ï¼šå†åšæŒä¸€ä¸‹ï¼Œå°±ä¸€ä¸‹ä¸‹ã€‚
                            </p>
                            <p class="text-gray-700 text-sm leading-relaxed mb-3">
                                æ¯ä¸ªäººéƒ½ä¼šæœ‰ä½è°·æœŸï¼Œè¿™æ˜¯æˆé•¿å¿…ç»çš„è¿‡ç¨‹ã€‚å°±åƒæ˜¥å¤©çš„ç§å­ï¼Œ
                                éœ€è¦åœ¨é»‘æš—çš„åœŸå£¤ä¸­åšæŒä¸€æ®µæ—¶é—´ï¼Œæ‰èƒ½ç ´åœŸè€Œå‡ºï¼Œè§åˆ°é˜³å…‰ã€‚
                            </p>
                            <p class="text-gray-700 text-sm leading-relaxed">
                                æ‰€ä»¥ï¼Œè¯·ç»™è‡ªå·±å¤šä¸€äº›è€å¿ƒï¼Œå¤šä¸€äº›æ¸©æŸ”ã€‚ä½ æ­£åœ¨ç»å†çš„ï¼Œ
                                éƒ½æ˜¯ä¸ºäº†è®©ä½ å˜å¾—æ›´åŠ åšå¼ºå’Œç¾å¥½ã€‚
                            </p>
                        </div>
                        <div class="text-center">
                            <button class="bg-orange-500 text-white px-4 py-2 rounded-lg mr-2">ğŸ‘ æ²»æ„ˆ</button>
                            <button class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg">ğŸ“š æ›´å¤š</button>
                        </div>
                    </div>
                `
            };
            
            return contents[type] || contents.article;
        }

        // å¼€å§‹å†¥æƒ³
        function startMeditation() {
            let timeLeft = 300; // 5åˆ†é’Ÿ
            const timerElement = document.getElementById('meditationTimer');
            
            const timer = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                timeLeft--;
                
                if (timeLeft < 0) {
                    clearInterval(timer);
                    timerElement.textContent = 'å®Œæˆï¼';
                    showToast('å†¥æƒ³å®Œæˆï¼Œæ„Ÿè§‰å¦‚ä½•ï¼Ÿ', 'success');
                }
            }, 1000);
        }

        // å¼€å§‹å‘¼å¸ç»ƒä¹ 
        function startBreathing() {
            const guide = document.getElementById('breathingGuide');
            const instruction = document.getElementById('breathingInstruction');
            
            const phases = [
                { text: 'ç”¨é¼»å­å¸æ°”4ç§’', emoji: 'ğŸ«', duration: 4 },
                { text: 'å±ä½å‘¼å¸7ç§’', emoji: 'ğŸ˜¤', duration: 7 },
                { text: 'ç”¨å˜´å‘¼æ°”8ç§’', emoji: 'ğŸ˜®â€ğŸ’¨', duration: 8 }
            ];
            
            let phaseIndex = 0;
            let count = 0;
            
            const breathingTimer = setInterval(() => {
                const phase = phases[phaseIndex];
                guide.textContent = phase.emoji;
                instruction.textContent = `${phase.text} (${phase.duration - count})`;
                
                count++;
                
                if (count >= phase.duration) {
                    count = 0;
                    phaseIndex = (phaseIndex + 1) % phases.length;
                    
                    if (phaseIndex === 0) {
                        // å®Œæˆä¸€è½®
                        showToast('å®Œæˆä¸€è½®å‘¼å¸ç»ƒä¹ ï¼', 'success');
                    }
                }
            }, 1000);
            
            // ç»ƒä¹ 4è½®ååœæ­¢
            setTimeout(() => {
                clearInterval(breathingTimer);
                guide.textContent = 'ğŸ«';
                instruction.textContent = 'ç»ƒä¹ å®Œæˆï¼æ„Ÿå—å†…å¿ƒçš„å¹³é™';
            }, 80000); // çº¦80ç§’å®Œæˆ4è½®
        }

        // æ˜¾ç¤ºå¿«é€Ÿæƒ…ç»ªæ“ä½œ
        function showQuickMoodActions() {
            const actions = [
                { name: 'è®°å½•æƒ…ç»ª', action: () => document.getElementById('moodNote').focus() },
                { name: 'AIèŠå¤©', action: () => document.getElementById('moodChatInput').focus() },
                { name: 'æ”¾æ¾å†…å®¹', action: () => showToast('è¯·é€‰æ‹©ä¸‹æ–¹çš„æ”¾æ¾å†…å®¹', 'info') }
            ];
            
            const actionMenu = document.createElement('div');
            actionMenu.className = 'fixed bottom-32 right-4 bg-white rounded-lg shadow-lg p-2 z-50';
            actionMenu.innerHTML = actions.map(action => 
                `<button onclick="this.parentElement.remove(); ${action.action.toString().replace('() => ', '')}" class="block w-full text-left px-4 py-2 hover:bg-gray-100 rounded transition-colors">${action.name}</button>`
            ).join('');
            
            document.body.appendChild(actionMenu);
            
            setTimeout(() => {
                if (actionMenu.parentElement) {
                    actionMenu.remove();
                }
            }, 3000);
        }

        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = 'auto';
            }
        }

        // æ˜¾ç¤ºToastæç¤º
        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = `toast fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm text-white ${
                type === 'error' ? 'bg-red-500' : 
                type === 'success' ? 'bg-green-500' : 
                'bg-orange-500'
            }`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            anime({
                targets: toast,
                translateX: [300, 0],
                opacity: [0, 1],
                duration: 300,
                easing: 'easeOutQuad'
            });
            
            setTimeout(() => {
                anime({
                    targets: toast,
                    translateX: [0, 300],
                    opacity: [1, 0],
                    duration: 300,
                    easing: 'easeInQuad',
                    complete: () => {
                        if (toast.parentElement) {
                            toast.remove();
                        }
                    }
                });
            }, 3000);
        }

        // å›è½¦é”®å‘é€æ¶ˆæ¯
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const moodChatInput = document.getElementById('moodChatInput');
                if (document.activeElement === moodChatInput) {
                    sendMoodMessage();
                }
            }
            
            // ESCé”®å…³é—­æ¨¡æ€æ¡†
            if (e.key === 'Escape') {
                const openModal = document.querySelector('.modal.show');
                if (openModal) {
                    closeModal(openModal.id);
                }
            }
        });
    </script>
    <script src="main.js"></script>
</body>
</html>